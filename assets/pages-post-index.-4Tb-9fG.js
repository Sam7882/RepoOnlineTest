import{_ as e}from"./c-headerNav.BJNmr2MK.js";import{d as t,r as l,y as a,c as s,U as o,Y as n,j as u,k as p,a as i,b as c,w as d,e as r,E as f,A as m,n as _,i as g,I as h,l as b,F as v,m as k,h as x,t as y,G as C,u as S,g as w,Z as $,_ as T,L as V,$ as N,f as j,B as P,a0 as z}from"./index-Cj-FlayY.js";import{_ as A}from"./uni-easyinput.DHqsUhmS.js";import{_ as F,f as R,b as B,i as U}from"./_plugin-vue_export-helper.CHvQx3Zv.js";import{_ as I}from"./uni-icons.C6uMiXBE.js";import{_ as D}from"./uni-popup.hvGzmB57.js";import{_ as E,a as L,u as O}from"./usePostData.BF4D-tD2.js";import{_ as W}from"./uni-datetime-picker.DWC2DmqC.js";import{_ as q}from"./img-template-02.Bv2-iTE2.js";const G=F(t({__name:"post-postContent",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{expose:t,emit:S}){const w=e,$=S,T=l(w.modelValue||"");l();const V=l(w.modelValue||""),N=l(!1),j=l("");a({top:0,left:0});const P=[{id:1,name:"小帥"},{id:2,name:"Vue粉絲團"},{id:3,name:"uniApp高手"}],z=s((()=>P.filter((e=>e.name.toLowerCase().includes(j.value.toLowerCase()))))),F=s((()=>"position: absolute; top: 100%; left: 0px;")),R=()=>document.querySelector(".editor"),B=l(!1);return o((()=>{n((()=>{const e=R();e&&(e.innerText=w.modelValue||"")}))})),t({insertText:e=>{const t=R();if(!t)return;t.focus();const l=window.getSelection();if(!l||!l.rangeCount)return;const a=l.getRangeAt(0);a.deleteContents();const s=document.createTextNode(e);a.insertNode(s),a.setStartAfter(s),a.collapse(!0),l.removeAllRanges(),l.addRange(a),N.value=!0,B.value=!0,(()=>{const e=R();if(!e)return;const t=e.innerText;V.value=t,$("update:modelValue",t)})()}}),(e,t)=>{const l=u(p("uni-easyinput"),A),a=g;return c(),i(a,{class:"editor-wrapper"},{default:d((()=>[r(l,{class:"editor-input",type:"textarea",modelValue:_(T),"onUpdate:modelValue":t[0]||(t[0]=e=>m(T)?T.value=e:null),placeholder:"请输入内容"},null,8,["modelValue"]),f(r(a,{class:"suggestion-panel",style:h(_(F))},{default:d((()=>[(c(!0),b(v,null,k(_(z),(e=>(c(),i(a,{class:"suggestion-item",key:e.id,onClick:t=>(e=>{var t,l,a,s,o,n;console.log("selectSuggestion",e);const u=window.getSelection();if(!u||!u.rangeCount)return;u.getRangeAt(0);const p=u.anchorNode;if(console.log("node",p),!p)return;const i=p.textContent||"";if(console.log("🚀 ~ selectSuggestion ~ text:",i),B){const s=/[#@]([\u4e00-\u9fa5\w]{0,})$/.exec(i);if(console.log("match",s),!s)return;const o=s[0],n=i.lastIndexOf(o),c=n+o.length,d=i.slice(0,n),r=i.slice(c);p.textContent=d;const f=document.createElement("span");f.style.color="#0868aa",f.style.fontWeight="bold",f.textContent=o.charAt(0)+e;const m=document.createTextNode(" ");null==(t=p.parentNode)||t.insertBefore(f,p.nextSibling),null==(l=p.parentNode)||l.insertBefore(m,f.nextSibling),null==(a=p.parentNode)||a.insertBefore(document.createTextNode(r),m.nextSibling),u.collapse(m,1),N.value=!1,j.value="",B.value=!1}else{const t=/[#@]([\u4e00-\u9fa5\w]{1,})$/.exec(i);if(console.log("match",t),!t)return;const l=t[0],a=i.lastIndexOf(l),c=a+l.length,d=i.slice(0,a),r=i.slice(c);p.textContent=d;const f=document.createElement("span");f.style.color="#0868aa",f.style.fontWeight="bold",f.textContent=l.charAt(0)+e;const m=document.createTextNode(" ");null==(s=p.parentNode)||s.insertBefore(f,p.nextSibling),null==(o=p.parentNode)||o.insertBefore(m,f.nextSibling),null==(n=p.parentNode)||n.insertBefore(document.createTextNode(r),m.nextSibling),u.collapse(m,0),u.collapse(m,1),N.value=!1,j.value=""}const c=R();$("update:modelValue",(null==c?void 0:c.innerText)||"")})(e.name)},{default:d((()=>[x(y(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:1},8,["style"]),[[C,_(N)]])])),_:1})}}}),[["__scopeId","data-v-e194dfe7"]]),M=F(t({__name:"post-postSet",props:{defaultSelected:{type:String,default:"publish"}},emits:["updata:postSet"],setup(e,{expose:t,emit:a}){const{t:s}=S(),o=e,n=a,f=l(),m=l(o.defaultSelected?o.defaultSelected:"publish"),h=[{value:"publish",label:s("post.public")},{value:"fans",label:s("post.fansUser"),desc:s("post.followingFans")},{value:"subscription",label:s("post.subscriptionUser")}],C=l(!1),z=()=>{var e;null==(e=f.value)||e.close()},A=e=>{for(let t=0;t<h.length;t++)if(h[t].value===e.detail.value){m.value=e.detail.value;break}},F=()=>{C.value=!0,z()},R=e=>{e.show&&(C.value=!1),!e.show&&C.value?(n("updata:postSet",m.value),C.value=!1):e.show||C.value||(m.value=o.defaultSelected)};return t({open:()=>{var e;null==(e=f.value)||e.open()},close:z}),(e,t)=>{const l=w,a=u(p("uni-icons"),I),s=g,o=N,n=j,C=T,S=$,B=P,U=u(p("uni-popup"),D);return c(),i(U,{ref_key:"popupRef",ref:f,type:"bottom","background-color":"#f6f6f6",onChange:R},{default:d((()=>[r(s,{class:"popup-container"},{default:d((()=>[r(s,{class:"popup-header"},{default:d((()=>[r(l,{class:"popup-title"},{default:d((()=>[x(y(e.$t("post.publishSetting")),1)])),_:1}),r(a,{type:"close",size:"24",onClick:z})])),_:1}),r(s,{class:"popup-subtitle"},{default:d((()=>[x(y(e.$t("post.publishWhoCanSee")),1)])),_:1}),r(S,{class:"popup-options",onChange:A},{default:d((()=>[(c(),b(v,null,k(h,((e,t)=>r(C,{class:"popup-option",key:t},{default:d((()=>[r(s,{class:"popup-option-main"},{default:d((()=>[r(l,{class:"popup-option-title"},{default:d((()=>[x(y(e.label),1)])),_:2},1024),e.desc?(c(),i(l,{key:0,class:"popup-option-desc"},{default:d((()=>[x(y(e.desc),1)])),_:2},1024)):V("",!0)])),_:2},1024),r(s,{class:"popup-option-radio-container"},{default:d((()=>[r(o,{class:"popup-option-radio",value:e.value,color:"#937CFF",checked:_(m)===e.value},null,8,["value","checked"]),_(m)===e.value?(c(),i(s,{key:0,class:"popup-option-custom-checked"},{default:d((()=>[r(n,{class:"popup-option-custom-checked-image",src:E,mode:"widthFix"})])),_:1})):(c(),i(s,{key:1,class:"popup-option-custom-checked"},{default:d((()=>[r(n,{class:"popup-option-custom-checked-image",src:L,mode:"widthFix"})])),_:1}))])),_:2},1024)])),_:2},1024))),64))])),_:1}),r(s,{class:"popup-confirm-container"},{default:d((()=>[r(B,{class:"popup-confirm",onClick:F},{default:d((()=>[x(y(e.$t("common.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1},512)}}}),[["__scopeId","data-v-1f227fd7"]]),Y=F(t({__name:"post-dateTimePicker",emits:["update:autoDate"],setup(e,{expose:t,emit:a}){const o=a,n=l(),f=l("2025-02-25 19:18"),h=l(!1),C=s((()=>{const[e,t]=f.value.split(" "),[l,a,s]=e.split("-"),[o,n]=t.split(":");return[{label:"年",value:l},{label:"月",value:a},{label:"日",value:s},{label:"時",value:o},{label:"分",value:n}]})),S=s((()=>f.value.replace("-","/").replace("-","/").replace(" ","/"))),$=()=>{o("update:autoDate",f.value),T()},T=()=>{var e;null==(e=n.value)||e.close()},V=e=>{f.value=e,h.value=!1};return t({open:()=>{var e;null==(e=n.value)||e.open()},close:T}),(e,t)=>{const l=w,a=u(p("uni-icons"),I),s=g,o=u(p("uni-datetime-picker"),W),N=P,j=u(p("uni-popup"),D);return c(),i(j,{ref_key:"popupRef",ref:n,type:"bottom","background-color":"#f6f6f6"},{default:d((()=>[r(s,{class:"popup-container"},{default:d((()=>[r(s,{class:"popup-header"},{default:d((()=>[r(l,{class:"popup-title"},{default:d((()=>[x(y(e.$t("post.autoPublishSetting")),1)])),_:1}),r(a,{class:"popup-close",type:"closeempty",size:"16",onClick:T})])),_:1}),r(s,{class:"popup-content"},{default:d((()=>[r(s,{class:"popup-subtitle"},{default:d((()=>[x(y(e.$t("post.autoPublishSettingTip")),1)])),_:1}),r(s,{class:"example-body"},{default:d((()=>[r(o,{modelValue:_(f),"onUpdate:modelValue":t[1]||(t[1]=e=>m(f)?f.value=e:null),show:_(h),onClose:t[2]||(t[2]=e=>h.value=!1),onChange:V},{default:d((()=>[r(s,{class:"date-container",onClick:t[0]||(t[0]=e=>h.value=!0)},{default:d((()=>[(c(!0),b(v,null,k(_(C),((e,t)=>(c(),i(s,{class:"date-container-item",key:t},{default:d((()=>[r(l,{class:"date-label"},{default:d((()=>[x(y(e.label),1)])),_:2},1024),r(l,{class:"date-value"},{default:d((()=>[x(y(e.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["modelValue","show"])])),_:1}),r(s,{class:"result-text"},{default:d((()=>[r(l,null,{default:d((()=>[x(y(e.$t("post.autoPublishOnDate",{date:_(S)})),1)])),_:1})])),_:1}),r(s,{class:"popup-confirm-container"},{default:d((()=>[r(N,{class:"popup-confirm",onClick:$},{default:d((()=>[x(y(e.$t("common.confirm")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)}}}),[["__scopeId","data-v-29ebc0a0"]]),Z=F(t({__name:"index",setup(t){O();const a=l(),s=l(""),o=l(),n=l(),f=l("subscription"),h=e=>{},b=()=>{a.value.insertText("#"),console.log("addTag")},v=()=>{a.value.insertText("@"),console.log("addMention")},k=()=>{console.log("草稿"),R()},C=()=>{console.log("發佈"),B()},S=e=>{console.log(e.detail)},$=()=>{var e;null==(e=o.value)||e.open()},T=e=>{f.value=e,console.log("🚀 ~ 外層 :",f.value)},V=()=>{var e;null==(e=n.value)||e.open()},N=e=>{console.log("🚀 ~ 外層 :",e)},A=()=>{U()};return(t,l)=>{const F=u(p("c-headerNav"),e),R=j,B=u(p("post-postContent"),G),U=g,D=u(p("uni-icons"),I),E=w,L=z,O=P,W=u(p("post-postSet"),M),Z=u(p("post-dateTimePicker"),Y);return c(),i(U,{class:"publish-page"},{default:d((()=>[r(F,{title:t.$t("post.publish")},null,8,["title"]),r(U,{class:"publish-media-container"},{default:d((()=>[r(R,{class:"publish-media-preview",src:q,mode:"aspectFill"}),r(B,{ref_key:"postContentRef",ref:a,modelValue:_(s),"onUpdate:modelValue":[l[0]||(l[0]=e=>m(s)?s.value=e:null),h]},null,8,["modelValue"])])),_:1}),r(U,{class:"publish-tags-container"},{default:d((()=>[r(U,{class:"publish-tag",onClick:b},{default:d((()=>[r(D,{type:"tag",size:"16",color:"#999"}),x(" #"+y(t.$t("post.hashTag")),1)])),_:1}),r(U,{class:"publish-tag",onClick:v},{default:d((()=>[r(D,{type:"at",size:"16",color:"#999"}),x(" @"+y(t.$t("post.mention")),1)])),_:1})])),_:1}),r(U,{class:"publish-setting-item",onClick:A},{default:d((()=>[r(E,null,{default:d((()=>[x(y(t.$t("post.tagPeople")),1)])),_:1}),r(D,{class:"publish-setting-right",type:"right",size:"16",color:"#999"})])),_:1}),r(U,{class:"publish-setting-item",onClick:$},{default:d((()=>[r(U,{class:"publish-setting-left"},{default:d((()=>[r(E,null,{default:d((()=>[x(y(t.$t("post.publishSetting")),1)])),_:1}),r(E,{class:"desc"},{default:d((()=>[x(y(t.$t("post.publishSettingTip")),1)])),_:1})])),_:1}),r(D,{class:"publish-setting-right",type:"right",size:"16",color:"#999"})])),_:1}),r(U,{class:"publish-setting-item",onClick:V},{default:d((()=>[r(U,{class:"publish-setting-left"},{default:d((()=>[r(E,null,{default:d((()=>[x(y(t.$t("post.autoPublish")),1)])),_:1}),r(E,{class:"desc"},{default:d((()=>[x("2025/02/25/19:18 "+y(t.$t("post.autoPublishTip")),1)])),_:1})])),_:1}),r(D,{class:"publish-setting-right",type:"right",size:"16",color:"#999"})])),_:1}),r(U,{class:"publish-setting-item"},{default:d((()=>[r(E,null,{default:d((()=>[x(y(t.$t("post.allowComment")),1)])),_:1}),r(L,{class:"publish-setting-right-switch",checked:!0,color:"#937CFF",onChange:S})])),_:1}),r(U,{class:"publish-actions"},{default:d((()=>[r(O,{class:"btn-draft",type:"button",onClick:k},{default:d((()=>[r(D,{type:"trash",size:"18"}),x(" "+y(t.$t("post.draft")),1)])),_:1}),r(O,{class:"btn-publish",type:"button",onClick:C},{default:d((()=>[r(D,{type:"upload",size:"18"}),x(" "+y(t.$t("post.publish")),1)])),_:1})])),_:1}),r(W,{ref_key:"publishSettingRef",ref:o,defaultSelected:_(f),"onUpdata:postSet":T},null,8,["defaultSelected"]),r(Z,{ref_key:"autoPublishRef",ref:n,"onUpdate:autoDate":N},null,512)])),_:1})}}}),[["__scopeId","data-v-806b076d"]]);export{Z as default};
